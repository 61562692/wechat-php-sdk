<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a"><meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8"><meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88"><title>wechat-php-sdk项目文档 | wechat-php-sdk Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3,minimum-scale=1"><meta name="author" content="binsee"><meta name="description" content="微信平台 wechat-php-sdk 微信开发"><link rel="alternate" href="atom.xml" title="wechat-php-sdk Blog" type="application/atom+xml"><link rel="icon" href="/wechat-php-sdk/img/favicon.ico"><link rel="apple-touch-icon" href="/wechat-php-sdk/img/pacman.jpg"><link rel="apple-touch-icon-precomposed" href="/wechat-php-sdk/img/pacman.jpg"><link rel="stylesheet" href="/wechat-php-sdk/css/style.css" type="text/css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?aecd5057338b5b9ca0eac9a9d9fadbe7";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();</script></head><body><header><div><div id="textlogo"><h1 class="site-name"><a href="/wechat-php-sdk/" title="wechat-php-sdk Blog">wechat-php-sdk Blog</a></h1><h2 class="blog-motto">微信平台wechat-php-sdk开源项目，开发文档blog</h2></div><div class="navbar"><a class="navbutton navmobile" href="#" title="菜单"></a></div><nav class="animated"><ul><ul><li><a href="/wechat-php-sdk/">首页</a></li><li><a href="/wechat-php-sdk/archives">归档</a></li><li><a href="/wechat-php-sdk/update">更新日志</a></li><li><a href="/wechat-php-sdk/readme">项目文档</a></li><li><a href="/wechat-php-sdk/about">关于项目</a></li><li><form class="search" action="//google.com/search" method="get" accept-charset="utf-8"><label>Search</label><input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索"> <input type="hidden" name="q" value="site:binsee.github.io/wechat-php-sdk"></form></li></ul></ul></nav></div></header><div id="container"><div id="main" class="page" itemscope itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/wechat-php-sdk/readme/index.html" title="wechat-php-sdk项目文档" itemprop="url">wechat-php-sdk项目文档</a></h1><p class="article-author">By <a href="https://binsee.github.io/wechat-php-sdk" title="binsee">binsee</a></p><p class="article-time"><time datetime="2014-12-29T20:12:47.000Z" itemprop="datePublished">2014年12月30日</time> 更新日期:<time datetime="2015-01-13T16:15:00.000Z" itemprop="dateModified">2015年01月14日</time></p></header><div class="article-content"><div id="toc" class="toc-article"><h2 class="toc-title"><span>文章目录</span></h2><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#wechat-php-sdk项目"><span class="toc-number">1.</span> <span class="toc-text">wechat-php-sdk项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用详解"><span class="toc-number">1.1.</span> <span class="toc-text">使用详解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#项目内容"><span class="toc-number">2.</span> <span class="toc-text">项目内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#官方API类库"><span class="toc-number">2.1.</span> <span class="toc-text">官方API类库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主要功能"><span class="toc-number">2.1.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化动作"><span class="toc-number">2.1.2.</span> <span class="toc-text">初始化动作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#被动接口方法"><span class="toc-number">2.1.3.</span> <span class="toc-text">被动接口方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预定义常量列表："><span class="toc-number">2.1.4.</span> <span class="toc-text">预定义常量列表：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主动接口方法"><span class="toc-number">2.1.5.</span> <span class="toc-text">主动接口方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#非官方扩展API类库"><span class="toc-number">2.2.</span> <span class="toc-text">非官方扩展API类库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类主要方法"><span class="toc-number">2.2.1.</span> <span class="toc-text">类主要方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#授权登陆类库"><span class="toc-number">2.3.</span> <span class="toc-text">授权登陆类库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类主要方法-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">类主要方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内嵌JS脚本"><span class="toc-number">2.4.</span> <span class="toc-text">内嵌JS脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#微信内嵌网页特殊功能js调用："><span class="toc-number">2.4.1.</span> <span class="toc-text">微信内嵌网页特殊功能js调用：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全局返回码类"><span class="toc-number">2.5.</span> <span class="toc-text">全局返回码类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法"><span class="toc-number">2.5.1.</span> <span class="toc-text">使用方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#企业号API类库"><span class="toc-number">2.6.</span> <span class="toc-text">企业号API类库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主要功能-1"><span class="toc-number">2.6.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化动作-1"><span class="toc-number">2.6.2.</span> <span class="toc-text">初始化动作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#被动接口方法-1"><span class="toc-number">2.6.3.</span> <span class="toc-text">被动接口方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预定义常量列表"><span class="toc-number">2.6.4.</span> <span class="toc-text">预定义常量列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主动接口方法-1"><span class="toc-number">2.6.5.</span> <span class="toc-text">主动接口方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#旧版微信支付V2接口类库"><span class="toc-number">2.7.</span> <span class="toc-text">旧版微信支付V2接口类库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主要功能-2"><span class="toc-number">2.7.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化动作-2"><span class="toc-number">2.7.2.</span> <span class="toc-text">初始化动作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主动接口方法-2"><span class="toc-number">2.7.3.</span> <span class="toc-text">主动接口方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调用示例"><span class="toc-number">3.</span> <span class="toc-text">调用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#官方Wechat调用示例"><span class="toc-number">3.1.</span> <span class="toc-text">官方Wechat调用示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#企业号API类库调用示例"><span class="toc-number">3.2.</span> <span class="toc-text">企业号API类库调用示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展包Wechatext调用示例"><span class="toc-number">3.3.</span> <span class="toc-text">扩展包Wechatext调用示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#微信二维码Wechatauth登陆示例"><span class="toc-number">3.4.</span> <span class="toc-text">微信二维码Wechatauth登陆示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#新版微信JSAPI调用DEMO:"><span class="toc-number">3.5.</span> <span class="toc-text">新版微信JSAPI调用DEMO:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#License"><span class="toc-number">4.</span> <span class="toc-text">License</span></a></li></ol></div><h1 id="wechat-php-sdk项目">wechat-php-sdk项目</h1><p>微信公众平台php开发包,细化各项接口操作,支持链式调用,<br>欢迎Fork此项目.<br>weixin developer SDK.<br>项目创建人：<strong><a href="https://github.com/dodgepudding" target="_blank" rel="external">dodgepudding</a></strong><br>项目地址：<strong><a href="https://github.com/dodgepudding/wechat-php-sdk" target="_blank" rel="external">https://github.com/dodgepudding/wechat-php-sdk</a></strong><br>项目blog：<strong><a href="http://binsee.github.io/wechat-php-sdk" target="_blank" rel="external">http://binsee.github.io/wechat-php-sdk</a></strong></p><h2 id="使用详解">使用详解</h2><p>使用前需先打开微信帐号的开发模式，详细步骤请查看微信公众平台接口使用说明：<br>微信公众平台： <a href="http://mp.weixin.qq.com/wiki/" target="_blank" rel="external">http://mp.weixin.qq.com/wiki/</a><br>微信企业平台： <a href="http://qydev.weixin.qq.com/wiki/" target="_blank" rel="external">http://qydev.weixin.qq.com/wiki/</a></p><p>微信支付接入文档：<a href="https://mp.weixin.qq.com/cgi-bin/readtemplate?t=business/course2_tmpl" target="_blank" rel="external">https://mp.weixin.qq.com/cgi-bin/readtemplate?t=business/course2_tmpl</a></p><p>微信多客服：<a href="http://dkf.qq.com" target="_blank" rel="external">http://dkf.qq.com</a></p><h1 id="项目内容">项目内容</h1><hr><h2 id="官方API类库">官方API类库</h2><blockquote><p><strong>wechat.class.php</strong><br>调用官方API，具有更灵活的消息分类响应方式，支持链式调用操作 ；</p></blockquote><h3 id="主要功能">主要功能</h3><blockquote><ul><li>接入验证 <strong>（初级权限）</strong></li><li>自动回复（文本、图片、语音、视频、音乐、图文） <strong>（初级权限）</strong></li><li>菜单操作（查询、创建、删除） <strong>（菜单权限）</strong></li><li>客服消息（文本、图片、语音、视频、音乐、图文） <strong>（认证权限）</strong></li><li>二维码（创建临时、永久二维码，获取二维码URL） <strong>（服务号、认证权限）</strong></li><li>长链接转短链接接口 <strong>（服务号、认证权限）</strong></li><li>分组操作（查询、创建、修改、移动用户到分组） <strong>（认证权限）</strong></li><li>网页授权（基本授权，用户信息授权） <strong>（服务号、认证权限）</strong></li><li>用户信息（查询用户基本信息、获取关注者列表） <strong>（认证权限）</strong></li><li>多客服功能（客服管理、获取客服记录、客服会话管理） <strong>（认证权限）</strong></li><li>媒体文件（上传、获取） <strong>（认证权限）</strong></li><li>高级群发 <strong>（认证权限）</strong></li><li>模板消息（设置所属行业、添加模板、发送模板消息） <strong>（服务号、认证权限）</strong></li><li>卡券管理（创建、修改、删除、发放、门店管理等） <strong>（认证权限）</strong></li><li>语义理解 <strong>（服务号、认证权限）</strong></li><li>获取微信服务器IP列表 <strong>（初级权限）</strong></li><li>微信JSAPI授权(获取ticket、获取签名) <strong>（初级权限）</strong><br>备注：<br>初级权限：基本权限，任何正常的公众号都有此权限<br>菜单权限：正常的服务号、认证后的订阅号拥有此权限<br>认证权限：分为订阅号、服务号认证，如前缀服务号则仅认证的服务号有此权限，否则为认证后的订阅号、服务号都有此权限<br>支付权限：仅认证后的服务号可以申请此权限</li></ul></blockquote><h3 id="初始化动作">初始化动作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">   <span class="string">'token'</span>=&gt;<span class="string">'tokenaccesskey'</span>, <span class="comment">//填写你设定的key</span></div><div class="line">   <span class="string">'encodingaeskey'</span>=&gt;<span class="string">'encodingaeskey'</span>, <span class="comment">//填写加密用的EncodingAESKey</span></div><div class="line">   <span class="string">'appid'</span>=&gt;<span class="string">'wxdk1234567890'</span>, <span class="comment">//填写高级调用功能的app id, 请在微信开发模式后台查询</span></div><div class="line">   <span class="string">'appsecret'</span>=&gt;<span class="string">'xxxxxxxxxxxxxxxxxxx'</span> <span class="comment">//填写高级调用功能的密钥</span></div><div class="line">   );</div><div class="line"><span class="variable">$weObj</span> = <span class="keyword">new</span> Wechat(<span class="variable">$options</span>); <span class="comment">//创建实例对象</span></div><div class="line"><span class="comment">//TODO：调用$weObj各实例方法</span></div></pre></td></tr></table></figure><h3 id="被动接口方法">被动接口方法</h3><blockquote><ul><li>valid() 验证连接，被动接口处于加密模式时必须调用</li><li></li><li>getRev() 获取微信服务器发来信息(不返回结果)，被动接口必须调用</li><li>getRevData() 返回微信服务器发来的信息（数组）</li><li>getRevFrom() 返回消息发送者的userid</li><li>getRevTo() 返回消息接收者的id（即公众号id）</li><li>getRevType() 返回接收消息的类型</li><li>getRevID() 返回消息id</li><li>getRevCtime() 返回消息发送事件</li><li>getRevContent() 返回消息内容正文或语音识别结果（文本型）</li><li>getRevPic() 返回图片信息（图片型信息） 返回数组{‘mediaid’=&gt;’’,’picurl’=&gt;’’}</li><li>getRevLink() 接收消息链接（链接型信息） 返回数组{‘url’=&gt;’’,’title’=&gt;’’,’description’=&gt;’’}</li><li>getRevGeo() 返回地理位置（位置型信息） 返回数组{‘x’=&gt;’’,’y’=&gt;’’,’scale’=&gt;’’,’label’=&gt;’’}</li><li>getRevEventGeo() 返回事件地理位置（事件型信息） 返回数组{‘x’=&gt;’’,’y’=&gt;’’,’precision’=&gt;’’}</li><li>getRevEvent() 返回事件类型（事件型信息） 返回数组{‘event’=&gt;’’,’key’=&gt;’’}</li><li>getRevScanInfo() 获取自定义菜单的扫码推事件信息，事件类型为<code>scancode_push</code>或<code>scancode_waitmsg</code> 返回数组array (‘ScanType’=&gt;’qrcode’,’ScanResult’=&gt;’123123’)</li><li>getRevSendPicsInfo() 获取自定义菜单的图片发送事件信息,事件类型为<code>pic_sysphoto</code>或<code>pic_photo_or_album</code>或<code>pic_weixin</code> 数组结构见php文件内方法说明</li><li>getRevSendGeoInfo() 获取自定义菜单的地理位置选择器事件推送，事件类型为<code>location_select</code> 数组结构见php文件内方法说明</li><li>getRevVoice() 返回语音信息（语音型信息） 返回数组{‘mediaid’=&gt;’’,’format’=&gt;’’}</li><li>getRevVideo() 返回视频信息（视频型信息） 返回数组{‘mediaid’=&gt;’’,’thumbmediaid’=&gt;’’}</li><li>getRevTicket() 返回接收TICKET（扫描带参数二维码,关注或SCAN事件） 返回二维码的ticket值</li><li>getRevSceneId() 返回二维码的场景值（扫描带参数二维码的关注事件） 返回二维码的参数值</li><li>getRevTplMsgID() 返回主动推送的消息ID（群发或模板消息事件） 返回MsgID值</li><li>getRevStatus() 返回模板消息发送状态（模板消息事件） 返回文本：success(成功)|failed:user block(用户拒绝接收)|failed: system failed(发送失败（非用户拒绝）)</li><li>getRevResult() 返回群发或模板消息发送结果（群发或模板消息事件） 返回数组，内容依事件类型而不同，参考开发文档中群发、模板消息推送事件</li><li>getRevKFCreate() 返回多客服-接入会话的客服账号（多客服-接入会话事件） 返回文本型</li><li>getRevKFClose() 返回多客服-处理会话的客服账号（多客服-接入会话事件） 返回文本型</li><li>getRevKFSwitch() 返回多客服-转接会话信息（多客服-转接会话事件） 返回数组 {‘FromKfAccount’ =&gt; ‘’,’ToKfAccount’ =&gt; ‘’}</li><li>getRevCardPass() 返回卡券-审核通过的卡券ID（卡券-卡券审核事件） 返回文本型</li><li>getRevCardGet() 返回卡券-用户领取卡券的相关信息（卡券-领取卡券事件） 返回数组{‘CardId’ =&gt; ‘’,’IsGiveByFriend’ =&gt; ‘’,’UserCardCode’ =&gt; ‘’}</li><li>getRevCardDel() 返回卡券-用户删除卡券的相关信息（卡券-删除卡券事件） 返回数组{‘CardId’ =&gt; ‘’,’UserCardCode’ =&gt; ‘’}</li><li></li><li>text($text) 设置文本型消息，参数：文本内容</li><li>image($mediaid) 设置图片型消息，参数：图片的media_id</li><li>voice($mediaid) 设置语音型消息，参数：语音的media_id</li><li>video($mediaid=’’,$title,$description) 设置视频型消息，参数：视频的media_id、标题、摘要</li><li>music($title,$desc,$musicurl,$hgmusicurl=’’,$thumbmediaid=’’) 设置回复音乐，参数：音乐标题、音乐描述、音乐链接、高音质链接、缩略图的媒体id</li><li>news($newsData) 设置图文型消息，参数：数组。数组结构见php文件内方法说明</li><li>image($mediaid) 设置图片型消息，参数：图片的media_id</li><li>Message($msg = ‘’,$append = false) 设置发送的消息（一般不需要调用这个方法）</li><li>transfer_customer_service($customer_account = ‘’) 转接多客服，如不指定客服可不提供参数，参数：指定客服的账号</li><li>reply() 将以上已经设置好的消息，回复给微信服务器</li></ul></blockquote><h3 id="预定义常量列表：">预定义常量列表：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">////消息类型，使用实例调用getRevType()方法取得</span></div><div class="line"><span class="keyword">const</span> MSGTYPE_TEXT = <span class="string">'text'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_IMAGE = <span class="string">'image'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_LOCATION = <span class="string">'location'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_LINK = <span class="string">'link'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_EVENT = <span class="string">'event'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_MUSIC = <span class="string">'music'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_NEWS = <span class="string">'news'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_VOICE = <span class="string">'voice'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_VIDEO = <span class="string">'video'</span>;</div><div class="line"><span class="comment">////事件类型，使用实例调用getRevEvent()方法取得</span></div><div class="line"><span class="keyword">const</span> EVENT_SUBSCRIBE = <span class="string">'subscribe'</span>;       <span class="comment">//订阅</span></div><div class="line"><span class="keyword">const</span> EVENT_UNSUBSCRIBE = <span class="string">'unsubscribe'</span>;   <span class="comment">//取消订阅</span></div><div class="line"><span class="keyword">const</span> EVENT_SCAN = <span class="string">'SCAN'</span>;                 <span class="comment">//扫描带参数二维码</span></div><div class="line"><span class="keyword">const</span> EVENT_LOCATION = <span class="string">'LOCATION'</span>;         <span class="comment">//上报地理位置</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_VIEW = <span class="string">'VIEW'</span>;                     <span class="comment">//菜单 - 点击菜单跳转链接</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_CLICK = <span class="string">'CLICK'</span>;                   <span class="comment">//菜单 - 点击菜单拉取消息</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_SCAN_PUSH = <span class="string">'scancode_push'</span>;       <span class="comment">//菜单 - 扫码推事件(客户端跳URL)</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_SCAN_WAITMSG = <span class="string">'scancode_waitmsg'</span>; <span class="comment">//菜单 - 扫码推事件(客户端不跳URL)</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_SYS = <span class="string">'pic_sysphoto'</span>;          <span class="comment">//菜单 - 弹出系统拍照发图</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_PHOTO = <span class="string">'pic_photo_or_album'</span>;  <span class="comment">//菜单 - 弹出拍照或者相册发图</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_WEIXIN = <span class="string">'pic_weixin'</span>;         <span class="comment">//菜单 - 弹出微信相册发图器</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_LOCATION = <span class="string">'location_select'</span>;      <span class="comment">//菜单 - 弹出地理位置选择器</span></div><div class="line"><span class="keyword">const</span> EVENT_SEND_MASS = <span class="string">'MASSSENDJOBFINISH'</span>;        <span class="comment">//发送结果 - 高级群发完成</span></div><div class="line"><span class="keyword">const</span> EVENT_SEND_TEMPLATE = <span class="string">'TEMPLATESENDJOBFINISH'</span>;<span class="comment">//发送结果 - 模板消息发送结果</span></div><div class="line"><span class="keyword">const</span> EVENT_KF_SEESION_CREATE = <span class="string">'kfcreatesession'</span>;  <span class="comment">//多客服 - 接入会话</span></div><div class="line"><span class="keyword">const</span> EVENT_KF_SEESION_CLOSE = <span class="string">'kfclosesession'</span>;    <span class="comment">//多客服 - 关闭会话</span></div><div class="line"><span class="keyword">const</span> EVENT_KF_SEESION_SWITCH = <span class="string">'kfswitchsession'</span>;  <span class="comment">//多客服 - 转接会话</span></div><div class="line"><span class="keyword">const</span> EVENT_CARD_PASS = <span class="string">'card_pass_check'</span>;          <span class="comment">//卡券 - 审核通过</span></div><div class="line"><span class="keyword">const</span> EVENT_CARD_NOTPASS = <span class="string">'card_not_pass_check'</span>;   <span class="comment">//卡券 - 审核未通过</span></div><div class="line"><span class="keyword">const</span> EVENT_CARD_USER_GET = <span class="string">'user_get_card'</span>;        <span class="comment">//卡券 - 用户领取卡券</span></div><div class="line"><span class="keyword">const</span> EVENT_CARD_USER_DEL = <span class="string">'user_del_card'</span>;        <span class="comment">//卡券 - 用户删除卡券</span></div></pre></td></tr></table></figure><h3 id="主动接口方法">主动接口方法</h3><blockquote><ul><li>checkAuth($appid,$appsecret,$token) 此处传入公众后台高级接口提供的appid和appsecret, 或者手动指定$token为access_token。函数将返回access_token操作令牌</li><li>resetAuth($appid=’’) 删除验证数据</li><li>resetJsTicket($appid=’’) 删除JSAPI授权TICKET</li><li>getJsTicket($appid=’’,$jsapi_ticket=’’) 获取JSAPI授权TICKET</li><li>getJsSign($url, $timeStamp, $nonceStr, $appid=’’) 获取JsApi使用签名</li><li>createMenu($data) 创建菜单 $data菜单结构详见 <strong><a href="http://mp.weixin.qq.com/wiki/index.php?title=自定义菜单创建接口" target="_blank" rel="external">自定义菜单创建接口</a></strong></li><li>getServerIp() 获取微信服务器IP地址列表 返回数组array(‘127.0.0.1’,’127.0.0.1’)</li><li>getMenu() 获取菜单</li><li>deleteMenu() 删除菜单</li><li>uploadMedia($data, $type) 上传多媒体文件(注意上传大文件时可能需要先调用 set_time_limit(0) 避免超时)</li><li>getMedia() 获取接收到的音频、视频媒体文件</li><li>uploadMpVideo($data) 上传视频素材，当需要群发视频时，必须使用此方法得到的MediaID，否则无法显示</li><li>uploadArticles($data) 上传图文消息素材</li><li>sendMassMessage($data) 高级群发消息</li><li>sendGroupMassMessage($data) 高级群发消息（全体或分组群发）</li><li>deleteMassMessage($msg_id) 删除群发图文消息</li><li>previewMassMessage($data) 预览群发消息</li><li>queryMassMessage($msg_id) 查询群发消息发送状态</li><li>getQRCode($scene_id,$type=0,$expire=1800) 获取推广二维码ticket字串</li><li>getQRUrl($ticket) 获取二维码图片地址</li><li>getShortUrl($long_url) 长链接转短链接接口</li><li>getUserList($next_openid) 批量获取关注用户列表</li><li>getUserInfo($openid) 获取关注者详细信息</li><li>updateUserRemark($openid,$remark) 设置用户备注名</li><li>getGroup() 获取用户分组列表</li><li>getUserGroup($openid) 获取用户所在分组</li><li>createGroup($name) 新增自定分组</li><li>updateGroup($groupid,$name) 更改分组名称</li><li>updateGroupMembers($groupid,$openid) 移动用户分组</li><li>sendCustomMessage($data) 发送客服消息</li><li>getOauthRedirect($callback,$state,$scope) 获取网页授权oAuth跳转地址</li><li>getOauthAccessToken() 通过回调的code获取网页授权access_token</li><li>getOauthRefreshToken($refresh_token) 通过refresh_token对access_token续期</li><li>getOauthUserinfo($access_token,$openid) 通过网页授权的access_token获取用户资料</li><li>getOauthAuth($access_token,$openid) 检验授权凭证access_token是否有效</li><li>getSignature($arrdata,’sha1’) 生成签名字串</li><li>generateNonceStr($length=16) 获取随机字串</li><li>setTMIndustry($id1,$id2=’’) 模板消息，设置所属行业</li><li>addTemplateMessage($tpl_id) 模板消息，添加消息模板</li><li>sendTemplateMessage($data) 发送模板消息</li><li>getCustomServiceMessage($data) 获取多客服会话记录</li><li>transfer_customer_service($customer_account) 转发多客服消息</li><li>getCustomServiceKFlist() 获取多客服客服基本信息</li><li>getCustomServiceOnlineKFlist() 获取多客服在线客服接待信息</li><li>createKFSession($openid,$kf_account,$text=’’) 创建指定多客服会话</li><li>closeKFSession($openid,$kf_account,$text=’’) 关闭指定多客服会话</li><li>getKFSession($openid) 获取用户会话状态</li><li>getKFSessionlist($kf_account) 获取指定客服的会话列表</li><li>getKFSessionWait() 获取未接入会话列表</li><li>addKFAccount($account,$nickname,$password) 添加客服账号</li><li>updateKFAccount($account,$nickname,$password) 修改客服账号信息</li><li>deleteKFAccount($account) 删除客服账号</li><li>setKFHeadImg($account,$imgfile) 上传客服头像</li><li>querySemantic($uid,$query,$category,$latitude=0,$longitude=0,$city=””,$region=””) 语义理解接口 参数含义及返回的json内容请查看 <strong><a href="http://mp.weixin.qq.com/wiki/index.php?title=语义理解" target="_blank" rel="external">微信语义理解接口</a></strong></li><li>createCard($data) 创建卡券</li><li>updateCard($data) 修改卡券</li><li>delCard($card_id) 删除卡券</li><li>getCardInfo($card_id) 查询卡券详情</li><li>getCardColors() 获取颜色列表</li><li>getCardLocations() 拉取门店列表</li><li>addCardLocations($data) 批量导入门店信息</li><li>createCardQrcode($card_id) 生成卡券二维码</li><li>consumeCardCode($code) 消耗 code</li><li>decryptCardCode($encrypt_code) code 解码</li><li>checkCardCode($code) 获取 code 的有效性</li><li>getCardIdList($data) 批量查询卡列表</li><li>updateCardCode($code,$code_id,$new_code) 更改 code</li><li>unavailableCardCode($code) 设置卡券失效<strong>(不可逆)</strong></li><li>modifyCardStock($data) 库存修改</li><li>activateMemberCard($data) 激活/绑定会员卡，参数结构请参看卡券开发文档(6.1.1 激活/绑定会员卡)章节</li><li>updateMemberCard($data) 会员卡交易，参数结构请参看卡券开发文档(6.1.2 会员卡交易)章节</li><li>updateLuckyMoney($code,$balance,$card_id=’’) 更新红包金额</li><li>setCardTestWhiteList($openid=array(),$user=array()) 设置卡券测试白名单</li></ul></blockquote><h2 id="非官方扩展API类库"><del>非官方扩展API类库</del></h2><blockquote><p><strong>old_version/wechatext.class.php</strong><br><strong>此扩展类库已经不再更新，原因是官方对公众号开放了众多接口，此类库继续维护的意义不大</strong><br>非官方扩展API，需要配置公众平台账户和密码，能实现对已关注用户的点对点微信，此方式不保证长期有效。</p></blockquote><p>类方法里提及的用户id在接口返回结构里表述为FakeId, 属同一概念, 在下面wechatauth类里则表示为Uin, 用户id对应的微信号必须通过getInfo()方法通过返回数组的Username值获取, 但非关注关系用户资料不能获取.</p><p>调用下列方法前必须经过login()方法和checkValid()验证方法才能获得调用权限. 有的账户无法通过登陆可能因为要求提供验证码, 可以手动登陆后把获取到的cookie写进程序存放cookie的文件解决.</p><p>程序使用了经过修改的snoopy兼容式HTTP类方法, 在类似BAE/SAE云服务器上可能不能正常运行, 因为云服务的curl方法是经过重写的, 某些header参数如网站来源参数不被支持.</p><h3 id="类主要方法">类主要方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">send(<span class="variable">$id</span>,<span class="variable">$content</span>) 向某用户id发送微信文字信息 </div><div class="line">sendNews(<span class="variable">$id</span>,<span class="variable">$msgid</span>) 发送图文消息, 可通过getNewsList获取<span class="variable">$msgid</span></div><div class="line">getUserList(<span class="variable">$page</span>,<span class="variable">$pagesize</span>,<span class="variable">$groupid</span>) 获取用户信息</div><div class="line">getGroupList(<span class="variable">$page</span>,<span class="variable">$pagesize</span>) 获取群组信息</div><div class="line">getNewsList(<span class="variable">$page</span>,<span class="variable">$pagesize</span>) 获取图文信息列表 </div><div class="line">uploadFile(<span class="variable">$filepath</span>,<span class="variable">$type</span>) 上传附件,包括图片/音频/视频/缩略图</div><div class="line">getFileList(<span class="variable">$type</span>,<span class="variable">$page</span>,<span class="variable">$pagesize</span>) 获取素材库文件列表</div><div class="line">sendImage(<span class="variable">$id</span>,<span class="variable">$fid</span>) 发送图片消息</div><div class="line">sendAudio(<span class="variable">$id</span>,<span class="variable">$fid</span>) 发送音频消息</div><div class="line">sendVideo(<span class="variable">$id</span>,<span class="variable">$fid</span>) 发送视频消息 </div><div class="line">getInfo(<span class="variable">$id</span>) 根据id获取用户资料,注: 非关注关系用户资料不能获取  </div><div class="line">getNewMsgNum(<span class="variable">$lastid</span>) 获取从<span class="variable">$lastid</span>算起新消息的数目  </div><div class="line">getTopMsg() 获取最新一条消息的数据, 此方法获取的消息id可以作为检测新消息的<span class="variable">$lastid</span>依据  </div><div class="line">getMsg(<span class="variable">$lastid</span>,<span class="variable">$offset</span>=<span class="number">0</span>,<span class="variable">$perpage</span>=<span class="number">50</span>,<span class="variable">$day</span>=<span class="number">0</span>,<span class="variable">$today</span>=<span class="number">0</span>,<span class="variable">$star</span>=<span class="number">0</span>) </div><div class="line">  获取最新的消息列表, 列表将返回消息id, 用户id, 消息类型, 文字消息等参数  </div><div class="line">  消息返回结构:  {<span class="string">"id"</span>:<span class="string">"消息id"</span>,<span class="string">"type"</span>:<span class="string">"类型号(1为文字,2为图片,3为语音)"</span>,  </div><div class="line">                 <span class="string">"fileId"</span>:<span class="string">"0"</span>,<span class="string">"hasReply"</span>:<span class="string">"0"</span>,<span class="string">"fakeId"</span>:<span class="string">"用户uid"</span>,  </div><div class="line">                 <span class="string">"nickName"</span>:<span class="string">"昵称"</span>,<span class="string">"dateTime"</span>:<span class="string">"时间戳"</span>,<span class="string">"content"</span>:<span class="string">"文字内容"</span>}   </div><div class="line">getMsgImage(<span class="variable">$msgid</span>,<span class="variable">$mode</span>=<span class="string">'large'</span>) 若消息type类型为<span class="number">2</span>, 调用此方法获取图片数据  </div><div class="line">getMsgVoice(<span class="variable">$msgid</span>) 若消息type类型为<span class="number">3</span>, 调用此方法获取语音数据</div></pre></td></tr></table></figure><h2 id="授权登陆类库"><del>授权登陆类库</del></h2><blockquote><p><strong>old_version/wechatauth.class.php</strong><br><strong>此扩展类库已经不再更新，原因是官方开放平台对网站应用开放的有授权登陆接口，更标准，更好用。请查看：<a href="http://open.weixin.qq.com" target="_blank" rel="external">微信开放平台</a></strong></p><p>通过微信二维码登陆微信的API, 能实现第三方网站同步登陆。</p></blockquote><p>首先程序分别通过get_login_code和get_code_image方法获取授权二维码图片, 然后利用微信手机客户端扫描二维码图片后将自动跳出授权页面, 用户点击授权后即可获取对应的用户资料和头像信息. 详细验证步骤请看test3.php例子.</p><h3 id="类主要方法-1">类主要方法</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">get_login_code</span><span class="params">()</span> 获取登陆授权码, 通过授权码才能获取二维码  </span></div><div class="line"><span class="title">get_code_image</span><span class="params">($code='')</span> 将上面获取的授权码转换为图片二维码  </div><div class="line"><span class="title">verify_code</span><span class="params">()</span> 鉴定是否登陆成功,返回200为最终授权成功.  </div><div class="line"><span class="title">get_login_info</span><span class="params">()</span> 鉴定成功后调用此方法即可获取用户基本信息  </div><div class="line"><span class="title">get_avatar</span><span class="params">($url)</span> 获取用户头像图片数据  </div><div class="line"><span class="title">logout</span><span class="params">()</span> 注销登陆</div></pre></td></tr></table></figure><h2 id="内嵌JS脚本"><del>内嵌JS脚本</del></h2><blockquote><p><strong>old_version/wechat.js</strong><br><strong>此JS脚本已经废弃不再更新，原因是官方在微信6.0.2版本开放了全新的JSAPI接口，更全面好用。请查看：<a href="http://mp.weixin.qq.com/wiki" target="_blank" rel="external">微信公众平台WIKI</a></strong></p><p>通过调用js脚本，让使用微信打开的网页达到特定效果</p></blockquote><h3 id="微信内嵌网页特殊功能js调用：">微信内嵌网页特殊功能js调用：</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">WeixinJS.hideOptionMenu() 隐藏右上角按钮</div><div class="line">WeixinJS.showOptionMenu() 显示右上角按钮</div><div class="line">WeixinJS.hideToolbar() 隐藏工具栏</div><div class="line">WeixinJS.showToolbar() 显示工具栏</div><div class="line">WeixinJS.getNetworkType() 获取网络状态</div><div class="line">WeixinJS.closeWindow() 关闭窗口</div><div class="line">WeixinJS.scanQRCode() 扫描二维码</div><div class="line">WeixinJS.openUrlByExtBrowser(url) 使用浏览器打开网址</div><div class="line">WeixinJS.jumpToBizProfile(username) 跳转到指定公众账号页面</div><div class="line">WeixinJS.sendEmail(title,content) 发送邮件</div><div class="line">WeixinJS.openProductView(latitude,longitude,name,address,scale,infoUrl) 查看地图</div><div class="line">WeixinJS.addContact(username) 添加微信账号</div><div class="line">WeixinJS.imagePreview(urls,current) 调出微信内图片预览</div><div class="line">WeixinJS.payCallback(appId,<span class="keyword">package</span>,timeStamp,nonceStr,signType,paySign,<span class="keyword">callback</span>) 微信JsApi支付接口</div><div class="line">WeixinJS.editAddress(appId,addrSign,timeStamp,nonceStr,<span class="keyword">callback</span>) 微信JsApi支付接口</div></pre></td></tr></table></figure><ul><li>通过定义全局变量dataForWeixin配置触发分享的内容：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dataForWeixin={</div><div class="line">      appId:<span class="string">""</span>,</div><div class="line">      MsgImg:<span class="string">"消息图片路径"</span>,</div><div class="line">      TLImg:<span class="string">"时间线图路径"</span>,</div><div class="line">      url:<span class="string">"分享url路径"</span>,</div><div class="line">      title:<span class="string">"标题"</span>,</div><div class="line">      desc:<span class="string">"描述"</span>,</div><div class="line">      fakeid:<span class="string">""</span>,</div><div class="line">      callback:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{}</div><div class="line">   };</div></pre></td></tr></table></figure><h2 id="全局返回码类">全局返回码类</h2><blockquote><p>errCode.php<br>当调用API接口失败时，可以用此类来换取失败原因的中文说明。</p></blockquote><p>注意：微信公众号引用<code>errCode.php</code>，企业号引用<code>qyerrCode.php</code>。</p><h3 id="使用方法">使用方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">include</span> <span class="string">"errCode.php"</span>;  <span class="comment">//或 qyerrCode.php</span></div><div class="line"><span class="variable">$ret</span>=ErrCode::getErrText(<span class="number">48001</span>); <span class="comment">//错误码可以通过公众号类库的公开变量errCode得到</span></div><div class="line"><span class="keyword">if</span> (<span class="variable">$ret</span>) </div><div class="line">    <span class="keyword">echo</span> <span class="variable">$ret</span>;</div><div class="line"><span class="keyword">else</span> </div><div class="line">    <span class="keyword">echo</span> <span class="string">"未找到对应的内容"</span>;</div></pre></td></tr></table></figure><h2 id="企业号API类库">企业号API类库</h2><blockquote><p><strong>qywechat.class.php</strong><br>调用官方API，具有更灵活的消息分类响应方式，支持链式调用操作 ；</p></blockquote><h3 id="主要功能-1">主要功能</h3><blockquote><ul><li>接入验证</li><li>自动回复（文本、图片、语音、视频、音乐、图文）</li><li>菜单操作（查询、创建、删除）</li><li>部门管理（创建、更新、删除、获取部门列表）</li><li>成员管理（创建、更新、删除、获取成员信息，获取部门成员列表）</li><li>标签管理（创建、更新、删除、获取成员、添加成员、删除成员,获取标签列表）</li><li>媒体文件管理（上传、获取）</li><li>二次验证</li><li>OAuth2（生成授权url、获取成员信息）</li><li>获取企业微信服务器IP列表</li></ul></blockquote><h3 id="初始化动作-1">初始化动作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">  <span class="string">'token'</span>=&gt;<span class="string">'tokenaccesskey'</span>, <span class="comment">//填写应用接口的Token</span></div><div class="line">  <span class="string">'encodingaeskey'</span>=&gt;<span class="string">'encodingaeskey'</span>, <span class="comment">//填写加密用的EncodingAESKey</span></div><div class="line">  <span class="string">'appid'</span>=&gt;<span class="string">'wxdk1234567890'</span>, <span class="comment">//填写高级调用功能的app id</span></div><div class="line">  <span class="string">'appsecret'</span>=&gt;<span class="string">'xxxxxxxxxxxxxxxxxxx'</span>, <span class="comment">//填写高级调用功能的密钥</span></div><div class="line">  <span class="string">'agentid'</span>=&gt;<span class="string">'1'</span>, <span class="comment">//应用的id</span></div><div class="line">  <span class="string">'debug'</span>=&gt;<span class="keyword">false</span>, <span class="comment">//调试开关</span></div><div class="line">  <span class="string">'_logcallback'</span>=&gt;<span class="string">'logg'</span>, <span class="comment">//调试输出方法，需要有一个string类型的参数</span></div><div class="line">);</div><div class="line"> <span class="variable">$weObj</span> = <span class="keyword">new</span> Wechat(<span class="variable">$options</span>); <span class="comment">//创建实例对象</span></div><div class="line"> <span class="comment">//TODO：调用$weObj各实例方法</span></div></pre></td></tr></table></figure><h3 id="被动接口方法-1">被动接口方法</h3><blockquote><ul><li>valid() 验证连接，被动接口必须调用</li><li></li><li>getRev() 获取微信服务器发来信息(不返回结果)，被动接口必须调用</li><li>getRevData() 返回微信服务器发来的信息（数组）</li><li>getRevPostXml() 返回微信服务器发来的原始加密xml信息</li><li>getRevFrom() 返回消息发送者的userid</li><li>getRevTo() 返回消息接收者的id（即公众号id，一般与等同appid一致）</li><li>getRevAgentID() 返回接收消息的应用id</li><li>getRevType() 返回接收消息的类型</li><li>getRevID() 返回消息id</li><li>getRevCtime() 返回消息发送事件</li><li>getRevContent() 返回消息内容正文（文本型消息）</li><li>getRevPic() 返回图片信息（图片型信息） 返回数组{‘mediaid’=&gt;’’,’picurl’=&gt;’’}</li><li>getRevGeo() 返回地理位置（位置型信息） 返回数组{‘x’=&gt;’’,’y’=&gt;’’,’scale’=&gt;’’,’label’=&gt;’’}</li><li>getRevEventGeo() 返回事件地理位置（事件型信息） 返回数组{‘x’=&gt;’’,’y’=&gt;’’,’precision’=&gt;’’}</li><li>getRevEvent() 返回事件类型（事件型信息） 返回数组{‘event’=&gt;’’,’key’=&gt;’’}</li><li>getRevScanInfo() 获取自定义菜单的扫码推事件信息，事件类型为<code>scancode_push</code>或<code>scancode_waitmsg</code> 返回数组array (‘ScanType’=&gt;’qrcode’,’ScanResult’=&gt;’123123’)</li><li>getRevSendPicsInfo() 获取自定义菜单的图片发送事件信息,事件类型为<code>pic_sysphoto</code>或<code>pic_photo_or_album</code>或<code>pic_weixin</code> 数组结构见php文件内方法说明</li><li>getRevSendGeoInfo() 获取自定义菜单的地理位置选择器事件推送，事件类型为<code>location_select</code> 数组结构见php文件内方法说明</li><li>getRevVoice() 返回语音信息（语音型信息） 返回数组{‘mediaid’=&gt;’’,’format’=&gt;’’}</li><li>getRevVideo() 返回视频信息（视频型信息） 返回数组{‘mediaid’=&gt;’’,’thumbmediaid’=&gt;’’}</li><li></li><li>text($text) 设置文本型消息，参数：文本内容</li><li>image($mediaid) 设置图片型消息，参数：图片的media_id</li><li>voice($mediaid) 设置语音型消息，参数：语音的media_id</li><li>video($mediaid=’’,$title,$description) 设置视频型消息，参数：视频的media_id、标题、摘要</li><li>news($newsData) 设置图文型消息，参数：数组。数组结构见php文件内方法说明</li><li>image($mediaid) 设置图片型消息，参数：图片的media_id</li><li>Message($msg = ‘’,$append = false) 设置发送的消息（一般不需要调用这个方法）</li><li>reply() 将已经设置好的消息，回复给微信服务器</li></ul></blockquote><h3 id="预定义常量列表">预定义常量列表</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">////消息类型，使用实例调用getRevType()方法取得</span></div><div class="line"><span class="keyword">const</span> MSGTYPE_TEXT = <span class="string">'text'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_IMAGE = <span class="string">'image'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_LOCATION = <span class="string">'location'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_LINK = <span class="string">'link'</span>;    <span class="comment">//暂不支持</span></div><div class="line"><span class="keyword">const</span> MSGTYPE_EVENT = <span class="string">'event'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_MUSIC = <span class="string">'music'</span>;    <span class="comment">//暂不支持</span></div><div class="line"><span class="keyword">const</span> MSGTYPE_NEWS = <span class="string">'news'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_VOICE = <span class="string">'voice'</span>;</div><div class="line"><span class="keyword">const</span> MSGTYPE_VIDEO = <span class="string">'video'</span>;</div><div class="line"><span class="comment">////事件类型，使用实例调用getRevEvent()方法取得</span></div><div class="line"><span class="keyword">const</span> EVENT_SUBSCRIBE = <span class="string">'subscribe'</span>;       <span class="comment">//订阅</span></div><div class="line"><span class="keyword">const</span> EVENT_UNSUBSCRIBE = <span class="string">'unsubscribe'</span>;   <span class="comment">//取消订阅</span></div><div class="line"><span class="keyword">const</span> EVENT_LOCATION = <span class="string">'LOCATION'</span>;         <span class="comment">//上报地理位置</span></div><div class="line"><span class="keyword">const</span> EVENT_ENTER_AGENT = <span class="string">'enter_agent'</span>;   <span class="comment">//用户进入应用</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_VIEW = <span class="string">'VIEW'</span>;                     <span class="comment">//菜单 - 点击菜单跳转链接</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_CLICK = <span class="string">'CLICK'</span>;                   <span class="comment">//菜单 - 点击菜单拉取消息</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_SCAN_PUSH = <span class="string">'scancode_push'</span>;       <span class="comment">//菜单 - 扫码推事件(客户端跳URL)</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_SCAN_WAITMSG = <span class="string">'scancode_waitmsg'</span>; <span class="comment">//菜单 - 扫码推事件(客户端不跳URL)</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_SYS = <span class="string">'pic_sysphoto'</span>;          <span class="comment">//菜单 - 弹出系统拍照发图</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_PHOTO = <span class="string">'pic_photo_or_album'</span>;  <span class="comment">//菜单 - 弹出拍照或者相册发图</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_PIC_WEIXIN = <span class="string">'pic_weixin'</span>;         <span class="comment">//菜单 - 弹出微信相册发图器</span></div><div class="line"><span class="keyword">const</span> EVENT_MENU_LOCATION = <span class="string">'location_select'</span>;      <span class="comment">//菜单 - 弹出地理位置选择器</span></div><div class="line"><span class="keyword">const</span> EVENT_SEND_MASS = <span class="string">'MASSSENDJOBFINISH'</span>;        <span class="comment">//发送结果 - 高级群发完成</span></div><div class="line"><span class="keyword">const</span> EVENT_SEND_TEMPLATE = <span class="string">'TEMPLATESENDJOBFINISH'</span>;<span class="comment">//发送结果 - 模板消息发送结果</span></div></pre></td></tr></table></figure><h3 id="主动接口方法-1">主动接口方法</h3><blockquote><ul><li>checkAuth($appid=’’,$appsecret=’’,$token=’’) 通用auth验证方法,也用来换取ACCESS_TOKEN 。仅在需要手动指定access_token时才用<code>$token</code></li><li>resetAuth($appid=’’) 清除记录的ACCESS_TOKEN</li><li>createMenu($data,$agentid=’’) 创建菜单,参数:菜单内容数组,要创建菜单应用id</li><li>getMenu($agentid=’’) 获取菜单内容,参数:要获取菜单内容的应用id</li><li>deleteMenu($agentid=’’) 删除菜单,参数:要删除菜单的应用id</li><li>uploadMedia($data, $type) 上传媒体文件,参数请看php文件内方法说明(注意上传大文件时可能需要先调用 set_time_limit(0) 避免超时)</li><li>getMedia($media_id) 根据媒体文件ID获取媒体文件,参数:媒体id</li><li>getServerIp() 获取企业微信服务器IP地址列表 返回数组array(‘127.0.0.1’,’127.0.0.1’)</li><li>createDepartment($data) 创建部门,参数: array(“name”=&gt;”邮箱产品组”,”parentid”=&gt;”1”,”order” =&gt; “1”)</li><li>updateDepartment($data) 更新部门,参数: array(“id”=&gt;”1”，”name”=&gt;”邮箱产品组”,”parentid”=&gt;”1”,”order” =&gt; “1”)</li><li>deleteDepartment($id) 删除部门,参数：要删除的部门id</li><li>moveDepartment($data) 移动部门,参数：array(“department_id” =&gt; “5”,”to_parentid” =&gt; “2”,”to_position” =&gt; “1”)</li><li>getDepartment() 获取部门列表，返回部门数组。其中department部门列表数据。以部门的order字段从小到大排列</li><li>createUser($data) 创建成员，参数请看php文件内方法说明</li><li>updateUser($data) 更新成员，参数请看php文件内方法说明</li><li>deleteUser($userid) 删除成员，参数：员工UserID</li><li>deleteUsers($userids) 批量删除成员，参数：员工UserID数组</li><li>getUserInfo($userid) 获取成员信息，参数：员工UserID</li><li>getUserList($department_id,$fetch_child=0,$status=0) 获取部门成员，参数：部门id，是否递归获取子部门，获取类型。<br>0获取全部员工，1获取已关注成员列表，2获取禁用成员列表，4获取未关注成员列表。status可叠加</li><li>getUserListInfo($department_id,$fetch_child=0,$status=0) 获取部门成员详情，参数同上</li><li>getUserId($code,$agentid) 根据code获取员工UserID与手机设备号，参数：Oauth2.0或者二次验证返回的code值，跳转链接时所在的企业应用ID</li><li>sendInvite($userid,$invite_tips=’’) 邀请成员关注</li><li>createTag($data) 创建标签，参数：array(“tagname” =&gt; “UI”)</li><li>updateTag($data) 更新标签，参数：array(“tagid” =&gt; “1”,”tagname” =&gt; “UI”)</li><li>deleteTag($tagid) 删除标签，参数：标签TagID</li><li>getTag($tagid) 获取标签成员，参数：标签TagID</li><li>addTagUser($data) 增加标签成员，参数请看php文件内方法说明</li><li>delTagUser($data) 删除标签成员，参数请看php文件内方法说明</li><li>getTagList() 获取标签列表，返回标签数组</li><li>sendMessage($data) 主动发送信息接口，参数请看php文件内方法说明</li><li>authSucc($userid) 二次验证，参数： 员工UserID</li><li>getOauthRedirect($callback,$state=’STATE’,$scope=’snsapi_base’) 组合授权跳转接口url</li></ul></blockquote><h2 id="旧版微信支付V2接口类库">旧版微信支付V2接口类库</h2><blockquote><p><strong>old_version/wechatpay.class.php</strong><br>旧版微信支付类库(微信支付V2)，已移动至old_version目录下。<br>自2014年8月开始申请到的微信支付都是V3接口，据官方说V2的会陆续升级为V3接口，但时间及升级渠道未确认。</p></blockquote><h3 id="主要功能-2">主要功能</h3><p>&gt;</p><ul><li>获取access_token <strong>（初级权限）</strong></li><li>调用地址组件 <strong>（支付权限）</strong></li><li>生成订单签名数据 <strong>（支付权限）</strong></li><li>订单成功回调 <strong>（支付权限）</strong></li><li>发货通知 <strong>（支付权限）</strong></li><li>支付订单查询 <strong>（支付权限）</strong><blockquote><p>备注：<br>初级权限：基本权限，任何正常的公众号都有此权限<br>菜单权限：正常的服务号、认证后的订阅号拥有此权限<br>认证权限：分为订阅号、服务号认证，如前缀服务号则仅认证的服务号有此权限，否则为认证后的订阅号、服务号都有此权限<br>支付权限：仅认证后的服务号可以申请此权限</p></blockquote></li></ul><h3 id="初始化动作-2">初始化动作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line"><span class="string">'appid'</span>=&gt;<span class="string">'wxdk1234567890'</span>, <span class="comment">//填写高级调用功能的app id, 请在微信开发模式后台查询</span></div><div class="line"><span class="string">'appsecret'</span>=&gt;<span class="string">'xxxxxxxxxxxxxxxxxxx'</span>, <span class="comment">//填写高级调用功能的密钥</span></div><div class="line"><span class="string">'partnerid'</span>=&gt;<span class="string">'88888888'</span>, <span class="comment">//财付通商户身份标识，支付权限专用，没有可不填</span></div><div class="line"><span class="string">'partnerkey'</span>=&gt;<span class="string">''</span>, <span class="comment">//财付通商户权限密钥Key，支付权限专用</span></div><div class="line"><span class="string">'paysignkey'</span>=&gt;<span class="string">''</span> <span class="comment">//商户签名密钥Key，支付权限专用</span></div><div class="line">);</div><div class="line"><span class="variable">$weObj</span> = <span class="keyword">new</span> Wechat(<span class="variable">$options</span>); <span class="comment">//创建实例对象</span></div><div class="line"><span class="comment">//TODO：调用$weObj各实例方法</span></div></pre></td></tr></table></figure><h3 id="主动接口方法-2">主动接口方法</h3><blockquote><ul><li>checkAuth($appid=’’,$appsecret=’’,$token=’’) 获取access_token。可根据appid和appsecret获取，或手动指定access_token</li><li>resetAuth($appid=’’) 删除验证数据</li><li>getSignature($arrdata,’sha1’) 生成签名字串</li><li>generateNonceStr($length=16) 获取随机字串</li><li>createNativeUrl($productid) 生成原生支付url</li><li>createPackage($out_trade_no,$body,$total_fee,$notify_url,$spbill_create_ip,$fee_type=1,$bank_type=”WX”,$input_charset=”UTF-8”,$time_start=””,$time_expire=””,$transport_fee=””,$product_fee=””,$goods_tag=””,$attach=””) 生成订单package字符串</li><li>getPaySign($package, $timeStamp, $nonceStr) 支付签名(paySign)生成方法</li><li>checkOrderSignature($orderxml=’’) 回调通知签名验证</li><li>sendPayDeliverNotify($openid,$transid,$out_trade_no,$status=1,$msg=’ok’) 发货通知</li><li>getPayOrder($out_trade_no) 查询订单信息</li><li>setUserToken($user_token) 设置用户授权密钥</li><li>getAddrSign($url, $timeStamp, $nonceStr, $user_token=’’) 获取收货地址JS的签名</li></ul></blockquote><h1 id="调用示例">调用示例</h1><hr><h2 id="官方Wechat调用示例">官方Wechat调用示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test1.php</span></div><div class="line"><span class="keyword">include</span> <span class="string">"wechat.class.php"</span>;</div><div class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'token'</span>=&gt;<span class="string">'tokenaccesskey'</span>, <span class="comment">//填写你设定的key</span></div><div class="line">        <span class="string">'encodingaeskey'</span>=&gt;<span class="string">'encodingaeskey'</span> <span class="comment">//填写加密用的EncodingAESKey，如接口为明文模式可忽略</span></div><div class="line">    );</div><div class="line"><span class="variable">$weObj</span> = <span class="keyword">new</span> Wechat(<span class="variable">$options</span>);</div><div class="line"><span class="variable">$weObj</span><span class="variable">-&gt;valid</span>();<span class="comment">//明文或兼容模式可以在接口验证通过后注释此句，但加密模式一定不能注释，否则会验证失败</span></div><div class="line"><span class="variable">$type</span> = <span class="variable">$weObj</span><span class="variable">-&gt;getRev</span>()<span class="variable">-&gt;getRevType</span>();</div><div class="line"><span class="keyword">switch</span>(<span class="variable">$type</span>) {</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_TEXT:</div><div class="line">            <span class="variable">$weObj</span><span class="variable">-&gt;text</span>(<span class="string">"hello, I'm wechat"</span>)<span class="variable">-&gt;reply</span>();</div><div class="line">            <span class="keyword">exit</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_EVENT:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_IMAGE:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">            <span class="variable">$weObj</span><span class="variable">-&gt;text</span>(<span class="string">"help info"</span>)<span class="variable">-&gt;reply</span>();</div><div class="line">}</div></pre></td></tr></table></figure><h2 id="企业号API类库调用示例">企业号API类库调用示例</h2><hr><p>可参考<strong>test</strong>目录下的<strong>qydemo.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">include</span> <span class="string">"wechat.class.php"</span>;</div><div class="line"><span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'token'</span>=&gt;<span class="string">'9Ixxxxxxx'</span>,    <span class="comment">//填写应用接口的Token</span></div><div class="line">        <span class="string">'encodingaeskey'</span>=&gt;<span class="string">'d4o9WVg8sxxxxxxxxxxxxxxxxxxxxxx'</span>,<span class="comment">//填写加密用的EncodingAESKey</span></div><div class="line">        <span class="string">'appid'</span>=&gt;<span class="string">'wxa07979baxxxxxxxx'</span>,    <span class="comment">//填写高级调用功能的appid</span></div><div class="line">);</div><div class="line"><span class="variable">$weObj</span> = <span class="keyword">new</span> Wechat(<span class="variable">$options</span>);</div><div class="line"><span class="variable">$weObj</span><span class="variable">-&gt;valid</span>(); <span class="comment">//注意, 企业号与普通公众号不同，必须打开验证，不要注释掉</span></div><div class="line"><span class="variable">$type</span> = <span class="variable">$weObj</span><span class="variable">-&gt;getRev</span>()<span class="variable">-&gt;getRevType</span>();</div><div class="line"><span class="keyword">switch</span>(<span class="variable">$type</span>) {</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_TEXT:</div><div class="line">            <span class="variable">$weObj</span><span class="variable">-&gt;text</span>(<span class="string">"hello, I'm wechat"</span>)<span class="variable">-&gt;reply</span>();</div><div class="line">            <span class="keyword">exit</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_EVENT:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> Wechat::MSGTYPE_IMAGE:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">            <span class="variable">$weObj</span><span class="variable">-&gt;text</span>(<span class="string">"help info"</span>)<span class="variable">-&gt;reply</span>();</div><div class="line">}</div></pre></td></tr></table></figure><h2 id="扩展包Wechatext调用示例">扩展包Wechatext调用示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test2.php </span></div><div class="line">    <span class="keyword">include</span> <span class="string">"wechatext.class.php"</span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">logdebug</span><span class="params">(<span class="variable">$text</span>)</span></span>{</div><div class="line">        file_put_contents(<span class="string">'./data/log.txt'</span>,<span class="variable">$text</span>.<span class="string">"\n"</span>,FILE_APPEND);        </div><div class="line">    };</div><div class="line">    </div><div class="line">    <span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'account'</span>=&gt;<span class="string">'demo@domain.com'</span>,</div><div class="line">        <span class="string">'password'</span>=&gt;<span class="string">'demo'</span>,</div><div class="line">        <span class="string">'datapath'</span>=&gt;<span class="string">'./data/cookie_'</span>,</div><div class="line">            <span class="string">'debug'</span>=&gt;<span class="keyword">true</span>,</div><div class="line">            <span class="string">'logcallback'</span>=&gt;<span class="string">'logdebug'</span>    </div><div class="line">    ); </div><div class="line">    <span class="variable">$wechat</span> = <span class="keyword">new</span> Wechatext(<span class="variable">$options</span>);</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$wechat</span><span class="variable">-&gt;checkValid</span>()) {</div><div class="line">        <span class="comment">// 获取用户信息</span></div><div class="line">        <span class="variable">$data</span> = <span class="variable">$wechat</span><span class="variable">-&gt;getInfo</span>(<span class="string">'3974255'</span>);</div><div class="line">        var_dump(<span class="variable">$data</span>);</div><div class="line">        <span class="comment">// 获取最新一条消息</span></div><div class="line">        <span class="variable">$topmsg</span> = <span class="variable">$wechat</span><span class="variable">-&gt;getTopMsg</span>();</div><div class="line">        var_dump(<span class="variable">$topmsg</span>);</div><div class="line">        <span class="comment">// 主动回复消息</span></div><div class="line">        <span class="keyword">if</span> (<span class="variable">$topmsg</span> && <span class="variable">$topmsg</span>[<span class="string">'has_reply'</span>]==<span class="number">0</span>)</div><div class="line">        <span class="variable">$wechat</span><span class="variable">-&gt;send</span>(<span class="variable">$topmsg</span>[<span class="string">'fakeid'</span>],<span class="string">'hi '</span>.<span class="variable">$topmsg</span>[<span class="string">'nick_name'</span>].<span class="string">',rev:'</span>.<span class="variable">$topmsg</span>[<span class="string">'content'</span>]);    </div><div class="line">    }</div></pre></td></tr></table></figure><h2 id="微信二维码Wechatauth登陆示例">微信二维码Wechatauth登陆示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test3.php</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"../wechatauth.class.php"</span>;</div><div class="line">    session_start();</div><div class="line">    <span class="variable">$sid</span>  = session_id();</div><div class="line">    <span class="variable">$options</span> = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'account'</span>=&gt;<span class="variable">$sid</span>,</div><div class="line">        <span class="string">'datapath'</span>=&gt;<span class="string">'../data/cookiecode_'</span>,</div><div class="line">    ); </div><div class="line">    <span class="variable">$wechat</span> = <span class="keyword">new</span> Wechatauth(<span class="variable">$options</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">'code'</span>])) {</div><div class="line">        <span class="variable">$logincode</span> = <span class="variable">$_POST</span>[<span class="string">'code'</span>];</div><div class="line">        <span class="variable">$vres</span> = <span class="variable">$wechat</span><span class="variable">-&gt;set_login_code</span>(<span class="variable">$logincode</span>)<span class="variable">-&gt;verify_code</span>();</div><div class="line">        <span class="keyword">if</span> (<span class="variable">$vres</span>===<span class="keyword">false</span>) {</div><div class="line">            <span class="variable">$result</span> = <span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="number">0</span>);</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="variable">$result</span> = <span class="keyword">array</span>(<span class="string">'status'</span>=&gt;<span class="variable">$vres</span>);</div><div class="line">            <span class="keyword">if</span> (<span class="variable">$vres</span>==<span class="number">200</span>) {</div><div class="line">                <span class="variable">$result</span>[<span class="string">'info'</span>] = <span class="variable">$wechat</span><span class="variable">-&gt;get_login_info</span>();</div><div class="line">                <span class="variable">$result</span>[<span class="string">'cookie'</span>] = <span class="variable">$wechat</span><span class="variable">-&gt;get_login_cookie</span>(<span class="keyword">true</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keyword">die</span>(json_encode(<span class="variable">$result</span>));    </div><div class="line">    }</div><div class="line">    <span class="variable">$logincode</span> =  <span class="variable">$wechat</span><span class="variable">-&gt;get_login_code</span>(); <span class="comment">//获取授权码</span></div><div class="line">    <span class="variable">$qrimg</span> = <span class="variable">$wechat</span><span class="variable">-&gt;get_code_image</span>(); <span class="comment">//待输出的二维码图片</span></div></pre></td></tr></table></figure><p>HTML部分请看test/test3.php, 主要是定时ajax查询是否已经授权成功</p><h2 id="新版微信JSAPI调用DEMO:">新版微信JSAPI调用DEMO:</h2><p>请看test/jsapi目录</p><hr><h1 id="License">License</h1><p>This is licensed under the GNU LGPL, version 2.1 or later.<br>For details, see: <a href="http://creativecommons.org/licenses/LGPL/2.1/" target="_blank" rel="external">http://creativecommons.org/licenses/LGPL/2.1/</a></p></div><footer class="article-footer clearfix"><div class="article-share" id="share"><div data-url="https://binsee.github.io/wechat-php-sdk/readme/index.html" data-title="wechat-php-sdk项目文档 | wechat-php-sdk Blog" data-tsina="null" class="share clearfix"></div></div></footer></article><section class="comment"><div class="ds-thread" data-thread-key="/wechat-php-sdk/readme/index.html" data-title="wechat-php-sdk项目文档" data-url="https://binsee.github.io/wechat-php-sdk/readme/index.html" id="ds_thread"><noscript>Please enable JavaScript to view the <a href="//duoshuo.com/?ref_noscript">comments powered by duoshuo.</a></noscript></div></section></div></div><footer><div id="footer"><p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> & <a href="http://gengbiao.me" target="_blank" title="coney">coney</a> © 2015 <a href="https://binsee.github.io/wechat-php-sdk" target="_blank" title="binsee">binsee</a></p></div></footer><script src="/wechat-php-sdk/js/jquery-2.1.0.min.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"))}),o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))})});</script><script type="text/javascript">$(document).ready(function(){var t=$(".share"),a=t.attr("data-url"),e=encodeURIComponent(a),r=t.attr("data-title"),c=t.attr("data-tsina"),o=['<a href="#" class="overlay" id="qrcode"></a>','<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url='+e+'"/></div>','<a href="#textlogo" class="article-back-to-top" title="Top"></a>','<a href="https://www.facebook.com/sharer.php?u='+e+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>','<a href="https://twitter.com/intent/tweet?url='+e+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="http://service.weibo.com/share/share.php?title='+r+"&url="+e+"&ralateUid="+c+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="Weibo"></a>','<span title="Share to"></span>'].join("");t.append(o),$(".article-share-qrcode").click(function(){var t=$("#qrcode-pic").attr("data-src");$("#qrcode-pic").attr("src",t),$("#qrcode-pic").load(function(){$(".qrcode strong").text(" ")})})});</script><script type="text/javascript">var duoshuoQuery={short_name:"binsee"};!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//static.duoshuo.com/embed.js",e.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script><div class="bottom-btn"><a class="icon-gotop" href="javascript:void(0)" title="返回顶部"></a><script src="/wechat-php-sdk/js/gotop.js" type="text/javascript"></script></div><script src="/wechat-php-sdk/js/toc_aside_toggle.js" type="text/javascript"></script></body></html>